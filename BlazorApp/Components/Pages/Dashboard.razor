@page "/dashboard"
@using BlazorApp.Models
@using BlazorApp.Data
@using Microsoft.EntityFrameworkCore
@inject IDbContextFactory<BlazorApp.Data.BlazorAppContext> DbFactory

<PageTitle>Dashboard</PageTitle>

<div class="dashboard-container">
    <!-- Left Section -->
    <div class="dashboard-left">
        <h3>Select an account to view</h3>
        <!-- Dropdown menu -->
        <div class="dropdown-container">
            <select @onchange="OnAccountSelected" class="account-dropdown">
               
                @foreach (var account in BankAccounts)

                {
                    <option value="@account.BankAccountId">@account.AccountType - Balance: @account.AccountBalance</option>
                }
            </select>
        </div>

        <!-- Toggle Switch -->
        <div class="toggle-switch">
            <input type="checkbox" id="toggleView" class="toggle-checkbox" @onchange="OnToggleSwitchChange">
            <label for="toggleView" class="toggle-label">
                <span class="toggle-switch-text" data-view="list">List View</span>
                <span class="toggle-switch-text" data-view="graphical">Graphical View</span>
            </label>
        </div>
    </div>

    <!-- Right Section -->
    <div class="dashboard-right">
        <!-- Content of the right section -->
        <h3>@(SelectedAccount?.AccountType != null ? $"Account Details for {SelectedAccount?.AccountType}" : "No Account Selected")</h3>
    </div>
</div>

@code {
    private List<BankAccount> BankAccounts { get; set; } = new();

    private BankAccount? SelectedAccount { get; set; }

    private int currentUserId = 0; // Placeholder, replace with actual user ID when login implemented.



    protected override async Task OnInitializedAsync()

    {

        await LoadBankAccountsForUser();

    }



    private async Task LoadBankAccountsForUser()

    {

        using var context = DbFactory.CreateDbContext();



        // Fetch accounts for the user with ID = 0

        // This should be replaced with the actual logged-in user's ID in a real implementation.

        BankAccounts = await context.BankAccount

            .Where(account => account.UserAccountId == currentUserId)

            .ToListAsync();

    }



    private void OnAccountSelected(ChangeEventArgs e)

    {

        if (int.TryParse(e.Value.ToString(), out int accountId))

        {

            SelectedAccount = BankAccounts.FirstOrDefault(account => account.BankAccountId == accountId);

        }

    }



    private void OnToggleSwitchChange(ChangeEventArgs e)

    {

        bool isToggled = (bool)e.Value; // Get the toggle switch value

                                        // Implement the logic based on the toggle switch state

                                        // For now, just set up the method; logic for view change can be implemented later.

    }
}
